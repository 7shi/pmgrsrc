--- gnulib/lib/mbswidth.c.orig	Mon Oct  5 04:03:34 2009
+++ gnulib/lib/mbswidth.c	Mon Oct  5 04:21:15 2009
@@ -37,7 +37,26 @@
 
 #ifndef mbsinit
 # if !HAVE_MBSINIT
-#  define mbsinit(ps) 1
+/*#  define mbsinit(ps) 1*/
+/* patch from http://www.startide.jp/~dtana/diary/?2005/4/24 */
+#include <errno.h>
+int mbsinit(const mbstate_t *ps) { return 1; }
+size_t
+mbrtowc(wchar_t *pwc, const char *s, size_t n, mbstate_t *ps)
+{
+	int r;
+
+	if (n == 0)
+		return 0;
+
+	if (*s == '\0') {
+		pwc != NULL && (*pwc = L'\0');
+		return 0;
+	}
+	if ((r = mbtowc(pwc, s, n)) < 0)
+		errno = EILSEQ;
+	return (size_t)r;
+}
 # endif
 #endif
 
